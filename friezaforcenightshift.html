<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Frieza Force: Night Shift (Multi-Night)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  body {
    margin: 0; padding: 0;
    background: #040404;
    color: #00ffcc;
    font-family: 'Share Tech Mono', monospace;
    overflow: hidden;
    user-select: none;
  }
  #container {
    max-width: 720px;
    margin: 20px auto;
    background: #001111;
    border: 2px solid #00ffcc;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 0 15px #00ffcc88;
    display: flex;
    flex-direction: column;
    height: 90vh;
  }
  h1 {
    margin: 0 0 10px 0;
    text-align: center;
    letter-spacing: 2px;
    text-shadow: 0 0 8px #00ffcc99;
  }
  #output {
    flex: 1;
    background: #000d0d;
    border: 1px solid #00ffcc;
    padding: 15px;
    overflow-y: auto;
    white-space: pre-wrap;
    font-size: 1rem;
    line-height: 1.3;
    box-shadow: inset 0 0 10px #00ffcc55;
    border-radius: 5px;
  }
  #commands {
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
  }
  button.cmd-btn {
    background: #002222;
    border: 1.5px solid #00ffcc;
    color: #00ffcc;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1rem;
    padding: 8px 14px;
    cursor: pointer;
    border-radius: 4px;
    transition: 0.2s;
    flex: 1 1 130px;
    user-select: none;
  }
  button.cmd-btn:hover {
    background: #004444;
    box-shadow: 0 0 10px #00ffcc;
  }
  #statusBar {
    margin-top: 12px;
    border: 1px solid #00ffcc;
    padding: 8px 10px;
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    border-radius: 4px;
    background: #001a1a;
    box-shadow: inset 0 0 5px #00ffcc44;
  }
  #batteryBar {
    flex: 1;
    background: #003333;
    height: 18px;
    border-radius: 4px;
    margin-left: 8px;
    box-shadow: inset 0 0 6px #00ffcc33;
    position: relative;
  }
  #batteryFill {
    height: 100%;
    background: #00ffcc;
    width: 100%;
    border-radius: 4px;
    transition: width 0.3s ease-in-out;
    box-shadow: 0 0 10px #00ffccaa;
  }
  #breathGame {
    margin-top: 15px;
    padding: 15px;
    background: #002222;
    border: 2px solid #00ffcc;
    border-radius: 8px;
    text-align: center;
    display: none;
  }
  #breathGame p {
    margin: 10px 0;
    font-weight: bold;
    font-size: 1.1rem;
  }
  #tapBtn {
    background: #004444;
    border: 2px solid #00ffcc;
    color: #00ffcc;
    font-size: 1.2rem;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 6px;
    user-select: none;
  }
  #tapBtn:active {
    background: #006666;
  }
  #logLore {
    margin-top: 15px;
    padding: 10px;
    background: #001515;
    border: 1px solid #00ffcc;
    border-radius: 5px;
    max-height: 140px;
    overflow-y: auto;
    font-size: 0.85rem;
    line-height: 1.2;
    font-style: italic;
  }
  /* Scouter flicker effect */
  @keyframes flicker {
    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
      opacity: 1;
    }
    20%, 22%, 24%, 55% {
      opacity: 0.5;
    }
  }
  #output {
    animation: flicker 3s infinite;
  }
</style>
</head>
<body>
<div id="container">
  <h1>Frieza Force: Night Shift</h1>
  <div id="output">You are on NIGHT 1 SHIFT, Frieza Force Unit 89. Stay alert.\nType a command or use the buttons below.</div>
  <div id="commands">
    <button class="cmd-btn" data-cmd="scan">Scan</button>
    <button class="cmd-btn" data-cmd="status">Status</button>
    <button class="cmd-btn" data-cmd="move hangar">Move Hangar</button>
    <button class="cmd-btn" data-cmd="move lab">Move Lab</button>
    <button class="cmd-btn" data-cmd="move cells">Move Cells</button>
    <button class="cmd-btn" data-cmd="move command">Move Command</button>
    <button class="cmd-btn" data-cmd="move armory">Move Armory</button>
    <button class="cmd-btn" data-cmd="hide">Hide</button>
    <button class="cmd-btn" data-cmd="escape">Escape</button>
    <button class="cmd-btn" data-cmd="call help">Call Help</button>
    <button class="cmd-btn" data-cmd="comply">Comply</button>
  </div>
  <div id="statusBar">
    <div>Night: <span id="nightNumber">1</span></div>
    <div>Location: <span id="location">Hangar</span></div>
    <div>Power: <span id="powerPercent">100%</span>
      <div id="batteryBar"><div id="batteryFill"></div></div>
    </div>
    <div>Scouter: <span id="scouterStatus">Online</span></div>
  </div>

  <div id="breathGame">
    <p>HOLD YOUR BREATH! TAP THE BUTTON FAST TO SURVIVE!</p>
    <p>Time Left: <span id="breathTime">20</span>s | Taps: <span id="tapCount">0</span></p>
    <button id="tapBtn">TAP</button>
  </div>

  <div id="logLore" title="Lore & Messages Log"></div>
</div>

<script>
(() => {
  const output = document.getElementById("output");
  const locationEl = document.getElementById("location");
  const powerPercent = document.getElementById("powerPercent");
  const batteryFill = document.getElementById("batteryFill");
  const scouterStatus = document.getElementById("scouterStatus");
  const breathGame = document.getElementById("breathGame");
  const breathTimeEl = document.getElementById("breathTime");
  const tapCountEl = document.getElementById("tapCount");
  const tapBtn = document.getElementById("tapBtn");
  const logLore = document.getElementById("logLore");
  const nightNumberEl = document.getElementById("nightNumber");

  let state = {
    location: "hangar",
    power: 100,
    scouterWorking: true,
    threatDetected: false,
    alive: true,
    time: 0,
    hiding: false,
    breathTimer: 20,
    taps: 0,
    eventTimer: 0,
    loreUnlocked: [],
    batteryDrainRate: 1,
    night: 1,
    calledHelp: false,
    complied: false,
    ginyuInspecting: false,
  };

  // Locations description (added Armory)
  const locations = {
    hangar: "Dark and echoing. Scouter interference detected.",
    lab: "Shattered glass. Bio-capsules broken. Warning: containment breach.",
    cells: "Empty... mostly. One pod hisses softly.",
    command: "Monitors flicker. A shadow moves in camera 3.",
    armory: "Locked weapons and armor. Old gear scattered on floor."
  };

  const loreTexts = {
    tarble: "Secret logs reveal Tarble, King Vegeta's hidden son, was sent far away to keep his existence a secret.",
    mang: "A rebel named Mang, of the same race as Recoome, secretly controls a moon used as a base for insurgents.",
    oozaru: "The moon's reflection activates the Oozaru transformation in some Saiyans. Warning: potential uncontrollable berserkers.",
    spacepod: "A missing spacepod was last tracked near the outer rim, with an unknown Saiyan warrior aboard. Its status is unknown.",
    prince: "A child born with a higher power level than the prince is rumored to exist. Records are heavily redacted.",
    zui: "Zui, a low-ranking spaceport manager, appears to favor certain Saiyans — his true motives remain unclear."
  };

  function appendOutput(text) {
    output.textContent += text + "\n";
    output.scrollTop = output.scrollHeight;
  }
  function appendLore(text) {
    logLore.textContent += "→ " + text + "\n";
    logLore.scrollTop = logLore.scrollHeight;
  }

  function updateStatus() {
    locationEl.textContent = state.location.charAt(0).toUpperCase() + state.location.slice(1);
    powerPercent.textContent = state.power + "%";
    batteryFill.style.width = state.power + "%";
    if (state.power > 50) batteryFill.style.background = "#00ffcc";
    else if (state.power > 25) batteryFill.style.background = "#ffaa00";
    else batteryFill.style.background = "#ff3300";
    scouterStatus.textContent = state.scouterWorking ? "Online" : "Offline";
    scouterStatus.style.color = state.scouterWorking ? "#00ffcc" : "#ff3300";
    nightNumberEl.textContent = state.night;
  }

  function endGame(message) {
    appendOutput("\n" + message);
    appendOutput("GAME OVER. Refresh to restart.");
    state.alive = false;
    disableCommands();
  }

  function disableCommands() {
    document.querySelectorAll("button.cmd-btn").forEach(btn => btn.disabled = true);
  }

  function randomLoreUnlock() {
    const keys = Object.keys(loreTexts);
    const available = keys.filter(k => !state.loreUnlocked.includes(k));
    if (available.length === 0) return;
    if (Math.random() < 0.3) {
      const idx = Math.floor(Math.random() * available.length);
      const lore = loreTexts[available[idx]];
      state.loreUnlocked.push(available[idx]);
      appendLore(lore);
    }
  }

  function nextNight() {
    state.night++;
    state.power = 100;
    state.threatDetected = false;
    state.calledHelp = false;
    state.complied = false;
    state.ginyuInspecting = false;
    state.time = 0;
    state.location = "hangar";
    appendOutput(`\n=== NIGHT ${state.night} BEGINS ===`);
    appendOutput("New threats may arise. Stay vigilant.");
    updateStatus();
  }

  // Events & threats progression per night
  function nightEvents() {
    if (!state.alive || state.hiding) return;

    state.time++;
    // Battery drains faster if threat detected
    state.power = Math.max(0, state.power - (state.threatDetected ? 2 : 1));
    updateStatus();

    // Night-specific events:
    switch(state.night) {
      case 1:
      case 2:
        if (state.time === 3) {
          appendOutput("Your scouter picks up faint Ki readings nearby.");
          appendLore("Small hostiles lurking in the shadows.");
          state.threatDetected = true;
        }
        if (state.time === 7 && !state.hiding) {
          appendOutput("You hear shuffling sounds near the lab.");
          appendLore("Possible enemy patrol.");
          state.power = Math.max(0, state.power - 10);
          updateStatus();
        }
        if (state.power <= 15) appendOutput("Power critically low! Recharge soon!");
        if (state.time >= 10) {
          endGame("Hostiles overwhelm your position. YOU DIDN'T MAKE IT.");
        }
        break;

      case 3:
      case 4:
        if (state.time === 2 && !state.threatDetected) {
          appendOutput("Warning: Larger Ki signature detected! Stay alert!");
          appendLore("A dangerous warrior approaches.");
          state.threatDetected = true;
          state.batteryDrainRate = 2;
        }
        if (state.time === 5) {
          appendOutput("Static on comms. You can try to 'call help' for backup.");
        }
        if (state.power <= 15) appendOutput("Power critically low! Recharge soon!");
        if (state.time === 8 && state.threatDetected && !state.hiding) {
          appendOutput("Enemy forces breach command center!");
          state.power = Math.max(0, state.power - 20);
          updateStatus();
        }
        if (state.time >= 12 && !state.calledHelp) {
          endGame("No help arrived. You were overwhelmed.");
        }
        if (state.time >= 14 && state.calledHelp) {
          appendOutput("Backup has arrived! Enemy forces retreating.");
          state.threatDetected = false;
          state.batteryDrainRate = 1;
          updateStatus();
        }
        break;

      case 5:
      case 6:
        if (state.time === 1) {
          appendOutput("You feel tension in the air... No escape yet.");
        }
        if (state.time === 4 && !state.threatDetected) {
          appendOutput("Hostile scouts spotted near the armory.");
          appendLore("Prepare for combat.");
          state.threatDetected = true;
          state.batteryDrainRate = 3;
        }
        if (state.time === 7 && !state.hiding) {
          appendOutput("An alarm sounds. Power drains rapidly.");
          state.power = Math.max(0, state.power - 25);
          updateStatus();
        }
        if (state.power <= 10) {
          appendOutput("Power too low. You can't escape!");
        }
        if (state.time >= 10 && state.power > 50) {
          appendOutput("Escape pod ready. You can now 'escape' from the hangar.");
        }
        if (state.time >= 13) {
          endGame("Enemies swarm all exits. YOU DIDN'T MAKE IT.");
        }
        break;

      case 7:
      case 8:
        if (state.time === 1) {
          appendOutput("Ginyu Force arrives for inspection.");
          appendLore("They are watching your every move.");
          state.ginyuInspecting = true;
          state.threatDetected = false;
          state.batteryDrainRate = 1;
        }
        if (state.time === 4 && state.ginyuInspecting) {
          appendOutput("Ginyu Force demands compliance. You can 'comply' or risk consequences.");
        }
        if (state.time === 7 && !state.complied) {
          endGame("Ginyu Force arrests you for non-compliance. YOU LOSE.");
        }
        if (state.complied) {
          appendOutput("Ginyu Force lets you stay under watch. Night continues...");
          state.ginyuInspecting = false;
          state.threatDetected = true; // Threats return after inspection
          state.batteryDrainRate = 2;
        }
        if (state.time >= 10) {
          appendOutput("Night ends peacefully... For now.");
          nextNight();
        }
        break;

      case 9:
      case 10:
        if (state.time === 2) {
          appendOutput("New hostile forces detected. Intelligence reports unknown power levels.");
          appendLore("More dangerous enemies closing in.");
          state.threatDetected = true;
          state.batteryDrainRate = 3;
        }
        if (state.time === 6 && !state.hiding) {
          appendOutput("You hear the roar of a massive beast nearby!");
          appendLore("Oozaru-class threat detected!");
          state.power = Math.max(0, state.power - 30);
          updateStatus();
        }
        if (state.power <= 5) {
          appendOutput("Power exhausted. You fall unconscious and are captured.");
          endGame("GAME OVER.");
        }
        if (state.time >= 12) {
          appendOutput("Survived another night. You live to fight again.");
          nextNight();
        }
        break;

      default:
        appendOutput("Quiet night... for now.");
        break;
    }

    // Random lore unlock every tick
    randomLoreUnlock();
  }

  // Breath minigame for hiding
  let breathInterval = null;
  function startBreathGame() {
    state.hiding = true;
    state.breathTimer = 20;
    state.taps = 0;
    breathGame.style.display = "block";
    breathTimeEl.textContent = state.breathTimer;
    tapCountEl.textContent = state.taps;

    breathInterval = setInterval(() => {
      state.breathTimer--;
      breathTimeEl.textContent = state.breathTimer;
      if (state.breathTimer <= 0) {
        clearInterval(breathInterval);
        breathGame.style.display = "none";
        state.hiding = false;
        if (state.taps >= 30) {
          appendOutput("...You remained silent. Threat passes by.");
          state.threatDetected = false;
          state.power = Math.min(100, state.power + 30);
          appendOutput("Power restored by 30% after surviving.");
          updateStatus();
        } else {
          endGame("You made noise! You were caught. GAME OVER.");
        }
      }
    }, 1000);
  }

  tapBtn.onclick = () => {
    if (!state.hiding) return;
    state.taps++;
    tapCountEl.textContent = state.taps;
  };

  // Command handler
  function handleCommand(cmd) {
    if (!state.alive) {
      appendOutput("You are dead. Refresh to restart.");
      return;
    }
    if (state.hiding) {
      appendOutput("You are hiding! Survive the breath challenge first!");
      return;
    }

    const [action, ...args] = cmd.toLowerCase().split(" ");
    const arg = args.join(" ");

    switch (action) {
      case "scan":
        if (!state.scouterWorking) {
          appendOutput("Scouter is fried. No response.");
        } else if (state.threatDetected) {
          appendOutput("Scouter detects: Ki unknown. Class: Oozaru? Power: ???");
        } else {
          appendOutput("No major Ki signatures detected.");
        }
        break;

      case "status":
        appendOutput(`Night: ${state.night}\nLocation: ${state.location.toUpperCase()}\nPower: ${state.power}%\nScouter: ${state.scouterWorking ? "Online" : "Offline"}`);
        break;

      case "move":
        if (!arg || !locations[arg]) {
          appendOutput("Invalid location. Try: hangar, lab, cells, command, armory.");
          return;
        }
        if (state.threatDetected && state.location === "command" && arg !== "command") {
          appendOutput("Warning: Leaving command post during threat is risky!");
        }
        state.location = arg;
        appendOutput(`You move to the ${arg.toUpperCase()}.\n${locations[arg]}`);
        updateStatus();
        break;

      case "hide":
        if (state.location === "cells" && state.threatDetected) {
          appendOutput("You hide in a broken pod... Holding your breath...");
          startBreathGame();
        } else {
          appendOutput("Nothing to hide here or no threat detected.");
        }
        break;

      case "escape":
        if (state.night < 5) {
          appendOutput("Escape not possible before Night 5.");
          return;
        }
        if (state.location === "hangar" && state.power > 50) {
          appendOutput("You launch a pod and escape into orbit. SURVIVED.");
          state.alive = false;
          disableCommands();
        } else {
          appendOutput("Escape failed. Must be in hangar with >50% power.");
        }
        break;

      case "call":
        if (arg === "help") {
          if (state.night >= 3 && !state.calledHelp) {
            appendOutput("You call for backup. Waiting for help to arrive...");
            state.calledHelp = true;
          } else if (state.calledHelp) {
            appendOutput("Help already called.");
          } else {
            appendOutput("No communication channels available yet.");
          }
        } else {
          appendOutput("Unknown call target.");
        }
        break;

      case "comply":
        if (state.ginyuInspecting && !state.complied) {
          appendOutput("You comply with Ginyu Force inspection.");
          state.complied = true;
        } else {
          appendOutput("No reason to comply now.");
        }
        break;

      default:
        appendOutput("Unknown command.");
    }
  }

  // Button click handlers
  document.querySelectorAll("button.cmd-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      if (!state.alive || state.hiding) return;
      const cmd = btn.getAttribute("data-cmd");
      appendOutput("> " + cmd);
      handleCommand(cmd);
    });
  });

  // Time tick every 7 seconds simulating night progression
  setInterval(() => {
    if (state.alive && !state.hiding) {
      nightEvents();
    }
  }, 7000);

  updateStatus();
  appendOutput("Commands available via buttons below.\nSurvive each night and escape starting from Night 5.");
})();
</script>
</body>
</html>